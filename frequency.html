<!--
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.6/nv.d3.min.css" />
-->
<style>

body {
	background: black;
}

.wrap {
	margin-left: 5vw;
	margin-top: 5vh;
	width: 90vw;
}

.tabby {
	width: 100%;
	text-align: center;
}

.tabby thead tr, .tabby tbody tr:nth-of-type(even) {
	background: silver;
}

.box1 {
	float:left;
	margin: 20px;
	width: calc(100% - 40px);
	min-height: 200px;
	background: white;
}

.box2 {
	float:left;
	margin: 20px;
	width: calc(50% - 40px);
	min-height: 200px;
	background: white;
}

@media screen and (max-width: 600px) {
  .box2 {
	width: calc(100% - 40px);
  }
}

.canvasjs-chart-credit {
	opacity: 0;
}

</style>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<!--
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.6/nv.d3.min.js"></script>
-->
<div class="wrap">
<textarea class="box1" id="mrField" placeholder="Insert Text"></textarea>
<div class="box2">
<table class="tabby" border="1">
	<thead>
		<tr>
			<th>
				Letter
			</th>
			<th>
				Frequency
			</th>
		</tr>
	</thead>
	<tbody id="ibbermand"></tbody>
</table>
</div>
<div class="box2" id="graphy" style="height: 650px;"></div>
</div>
<script>
var mrFrequency = function () {
	var mrF = this;
	mrF.charObject = { "Character" : null, "Code" : 0, "Count" : 0 };
	mrF.stdObject = { "Name" : null, "Letters"  : new Array() };
	mrF.standards = [
		{ 
			Name : "English",
			Letters : [
				{ Character : 'A', Frequency : 8.167, Count : 0 },
				{ Character : 'B', Frequency : 1.492, Count : 0 },
				{ Character : 'C', Frequency : 2.782, Count : 0 },	
				{ Character : 'D', Frequency : 4.253, Count : 0 },
				{ Character : 'E', Frequency : 12.702, Count : 0 },
				{ Character : 'F', Frequency : 2.228, Count : 0 },
				{ Character : 'G', Frequency : 2.015, Count : 0 },
				{ Character : 'H', Frequency : 6.094, Count : 0 },
				{ Character : 'I', Frequency : 6.966, Count : 0 },
				{ Character : 'J', Frequency : 0.153, Count : 0 },
				{ Character : 'K', Frequency : 0.772, Count : 0 },	
				{ Character : 'L', Frequency : 4.025, Count : 0 },	
				{ Character : 'M', Frequency : 2.406, Count : 0 },	
				{ Character : 'N', Frequency : 6.749, Count : 0 },	
				{ Character : 'O', Frequency : 7.507, Count : 0 },	
				{ Character : 'P', Frequency : 1.929 , Count : 0 },	
				{ Character : 'Q', Frequency : 0.095, Count : 0 },	
				{ Character : 'R', Frequency : 5.987, Count : 0 },	
				{ Character : 'S', Frequency : 6.327 , Count : 0 },	
				{ Character : 'T', Frequency : 9.056, Count : 0 },	
				{ Character : 'U', Frequency : 2.758, Count : 0 },	
				{ Character : 'V', Frequency : 0.978, Count : 0 },	
				{ Character : 'W', Frequency : 2.360, Count : 0 },	
				{ Character : 'X', Frequency : 0.150, Count : 0 },	
				{ Character : 'Y', Frequency : 1.974, Count : 0 },	
				{ Character : 'Z', Frequency : 0.074, Count : 0 }					
			]
		}
	];
	mrF.selected = mrF.standards[0];
	mrF.getAnalysis = function (text, allCharacters) {
		var result = JSON.parse(JSON.stringify(mrF.selected.Letters)); //new Array();
	
		if (!Array.isArray(text)) {
			text = new Array(text)
		}
		
		for (let t of text) {
			for (let i = 0; i < t.length; i++) {
				let ch = t.charAt(i);
				let bigChar = ch.toUpperCase();
				if (result.some(x => x.Character.toUpperCase() === bigChar)) {
					let c = result.find(x => x.Character.toUpperCase() === bigChar);
					c.Count++;
				}
				/*
				else {
					let theCode = bigChar.charCodeAt(0);
					// || theCode === 197 || theCode === 198 || theCode === 216
					if (!allCharacters || (theCode >= 65 && theCode <= 90)) {
						result.push(
							{ 
								"Character" : bigChar, 
								"Count" : 1,
								"Code" : theCode
							}
						);
					}
				}
				*/
			}
		}
		console.log(result);
		return result;
	};
	mrF.encodeText = function (text, caesar) {
		
		var charList = mrF.selected.Letters.map(x => x.Character);
		var cryptList = function (charList, caesar) {
			if (typeof caesar === "number") {
				return charList;
			}
			else {
				return charList;
			}
		};
		
		for (let i = 0; i < text.length; i++) {
			
		}

	};
	mrF.decodeText = function (text) {
	
	};

};
/*
var mrPill = function (elem) {
	var mrP = this;
	mrP.elem = document.getElementById(elem);
	mrP.ctx = mrP.elem.getContext("2d");
	mrP.drawPills = function (data, x, y) {
		var height = mrP.elem.offsetHeight;
		var width = mrP.elem.offsetWidth;
		mrP.elem.innerHTML = "";
		for (d of data) {
			mrP.elem.innerHTML += d.Count;
		}
	};
};
*/

var ib = new mrFrequency();
// var bo = new mrPill("graphy");

var theField = document.getElementById("mrField");
var ibber = document.getElementById("ibbermand");

theField.onkeyup = function (event) {
	drawIb(this.value);
};

function drawIb (text) {
	var freq = ib.getAnalysis(text, true).sort(function(x, y) {
			if (x.Character < y.Character) { 
				return -1; 
			}
			else if (x.Character > y.Character) { 
				return 1; 
			}
			else {
				return 0;
			}    
		});
	ibber.innerHTML = "";
	for (f of freq) {
		ibber.innerHTML += "<tr><td>" + f.Character + "</td><td>" + f.Count + "</td></tr>"
	}
	setTimeout(function () {
		renderChart(freq);
	}, 0);
	// bo.drawPills(freq, "Character", "Count");
};

function renderChart(freq) {

var dataArray = freq.map(x => 
	(
		{ "y" : x.Count, "label" : x.Character }
	)
).filter(x => x.y > 0);

var chart = new CanvasJS.Chart("graphy", {
	animationEnabled: true,
	theme: "light2", // "light1", "light2", "dark1", "dark2"
	title:{
		text: "Frequency of Letters"
	},
	axisY: {
		title: ""
	},
	data: [{        
		type: "column",  
		showInLegend: true, 
		legendMarkerColor: "transparent",
		legendText: " ",
		dataPoints: dataArray
	}]
});
chart.render();
}

drawIb(theField.value);



</script>